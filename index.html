<!DOCTYPE html> 
<html lang="zh-Hant"> 
  <head> 
    <meta charset="utf-8" /> 
    <meta name="viewport" content="width=device-width, initial-scale=1" /> 
    <title>å°å—å¤éƒ½é¦¬é…é€Ÿå°å¹«æ‰‹</title> 
    <link rel="icon" type="image/png" href="./APP_icon.png"> 
<link rel="apple-touch-icon" href="./APP_icon.png"> 
<link rel="apple-touch-icon" sizes="180x180" href="./APP_icon.png">
    <style> /* ------------------------ */ :root{ --main-orange: #ff7a2d; --accent-yellow: #ffd45a; --soft-white: #fffdf8; --muted: #6b6b6b; --card-shadow: 0 6px 18px rgba(255,120,45,0.12); --candy: radial-gradient(circle at 10% 20%, rgba(255,255,255,0.6) 0 6px, transparent 8px), radial-gradient(circle at 80% 70%, rgba(255,255,255,0.35) 0 5px, transparent 8px); }
  html,body{
  height:100%;
  margin:0;
  font-family: "Segoe UI", "Helvetica Neue", "Noto Sans TC", "Microsoft JhengHei", Arial, sans-serif;
  background: linear-gradient(180deg,#fff8ef 0%, #fff9f2 50%);
  color:#2b2b2b;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}

/* é é¢å®¹å™¨ */
.wrap{
  max-width:1100px;
  margin:18px auto;
  padding:18px;
  display:grid;
  grid-template-columns: 1fr 420px;
  gap:18px;
}

/* RWD: æ‰‹æ©Ÿä¸€æ¬„ */
@media (max-width:880px){
  .wrap{ grid-template-columns: 1fr; padding:14px; }
}

header{
  grid-column: 1 / -1;
  display:flex;
  align-items:center;
  gap:12px;
  background: linear-gradient(90deg,var(--main-orange), var(--accent-yellow));
  color:white;
  padding:12px 16px;
  border-radius:14px;
  box-shadow: var(--card-shadow);
}
header .logo{
  width:64px;height:64px;border-radius:12px;
  background: white;
  display:flex;align-items:center;justify-content:center;
  box-shadow: 0 6px 14px rgba(0,0,0,0.08);
  position:relative;
  overflow:hidden;
}
/* candy åœ–æ¨£ */
header .logo::after{
  content:"";
  position:absolute;inset:0;
  background: radial-gradient(circle at 30% 30%, rgba(255,204,128,0.9) 0 10px, transparent 11px),
              radial-gradient(circle at 70% 70%, rgba(255,255,255,0.25) 0 6px, transparent 8px);
  opacity:0.95;
}
header h1{ margin:0;font-size:20px; font-weight:700; letter-spacing:0.3px; }

/* å·¦å´è¼¸å…¥å€ */
.card{
  background: var(--soft-white);
  border-radius:14px;
  padding:14px;
  box-shadow: var(--card-shadow);
  position:relative;
}
.inputs {
  display:grid;
  gap:12px;
}
label{
  font-size:13px;color:var(--muted);display:block;margin-bottom:6px;
}
select, input[type="number"], input[type="text"]{
  width:100%;
  padding:10px 12px;
  border-radius:10px;
  border:1px solid rgba(0,0,0,0.06);
  font-size:15px;
  background:linear-gradient(#fff,#fff);
  box-sizing:border-box;
}
.row{ display:flex; gap:10px; align-items:center; }
.row .col{ flex:1; }

.stations{
  display:flex;
  flex-direction:column;
  gap:8px;
  margin-top:6px;
}
.station{
  padding:8px;
  border-radius:10px;
  background: linear-gradient(90deg, rgba(255,250,240,0.9), rgba(255,255,255,0.95));
  border:1px dashed rgba(255,122,45,0.12);
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:space-between;
}
.station .meta{ font-size:13px; color:#333; }
.station small{ display:block;color:var(--muted); font-size:12px; margin-top:4px; }

.btns{ display:flex; gap:10px; margin-top:10px; }
button{
  padding:10px 14px;
  border-radius:10px;
  border:none;
  font-weight:700;
  cursor:pointer;
}
button.calculate{
  background: linear-gradient(90deg,var(--main-orange), #ff9c4a);
  color:white; box-shadow: 0 8px 20px rgba(255,122,45,0.18);
}
button.reset{ background: white; border:1px solid rgba(0,0,0,0.06); }

/* å³å´çµæœå€ */
.result-panel{
  display:flex; flex-direction:column; gap:12px;
}
.summary{
  padding:12px;border-radius:12px;background:linear-gradient(90deg,#fff,#fff);
  box-shadow: var(--card-shadow);
}
.pace-big{
  font-size:28px;font-weight:800;color:var(--main-orange);
}
.encourage{
  margin-top:8px;font-weight:700;color:#444;background:linear-gradient(90deg, rgba(255,250,240,0.9), transparent);
  padding:8px;border-radius:10px;
}

/* é…é€Ÿè¡¨ï¼ˆå¯å·¦å³æ»‘å‹• on mobileï¼‰ */
.table-wrap{ overflow:auto;border-radius:10px; }
table{
  width:100%;
  border-collapse:collapse;
  min-width:720px;
  background: white;
}
th,td{
  padding:10px 12px;
  border-bottom:1px solid #f2f2f2;
  text-align:left;
  font-size:14px;
}
th{ background: linear-gradient(90deg, #fff9f5, #fff); color:#6b6b6b; position:sticky; top:0; z-index:1; }
td.remark{ color:var(--main-orange); font-weight:700; }

/* å¤©æ°£å¡ */
.weather{
  padding:12px;border-radius:12px;background:linear-gradient(90deg,#fff,#fff); box-shadow: var(--card-shadow);
}
.weather-list{ display:flex; gap:8px; overflow:auto; padding-bottom:6px; }
.weather-item{
  min-width:110px; padding:8px; border-radius:10px; background: linear-gradient(180deg,#fff8ef,#fff); text-align:center;
  box-shadow: 0 4px 10px rgba(0,0,0,0.04);
}
.weather-time{ font-size:12px; color:var(--muted); }
.weather-temp{ font-size:16px; font-weight:800; margin-top:6px; color:var(--main-orange); }
.weather-desc{ font-size:12px; color:#6b6b6b; margin-top:4px; }

/* å°æç¤ºèˆ‡éŒ¯èª¤è¨Šæ¯ */
.msg{ padding:10px;border-radius:10px;background:#fff6f3;border:1px solid rgba(255,122,45,0.12); color:#7a3b1b; font-weight:700; }

footer{ grid-column:1/-1; text-align:center; font-size:12px; color:var(--muted); margin-top:6px; }
/* é¿å…æ‰‹æ©Ÿæ©«å‘æ»¾å‹•å‡ºç¾ï¼ˆä¸»è¦æ˜¯å…§éƒ¨è¡¨æ ¼å¯å·¦å³æ»‘å‹•ï¼‰ */
html,body{ overflow-x:hidden; }
  </style> </head> <body> <div class="wrap"> <header> <div class="logo" aria-hidden="true"> <!-- å¯æ„›ç³–æœåœ–æ¡ˆï¼ˆSVG inlineï¼‰ --> <svg width="48" height="48" viewBox="0 0 24 24" fill="none" style="transform:scale(0.9)"> <rect x="2" y="6" width="20" height="12" rx="6" fill="#ffefdf"/> <path d="M4 9c2 0 3 3 6 3s4-3 6-3 4 3 6 3" stroke="#ff7a2d" stroke-width="0.7" opacity="0.9"/> <circle cx="7" cy="12" r="1.6" fill="#ffd45a"/> </svg> </div> <div> <h1>å°å—å¤éƒ½é¦¬é…é€Ÿå°å¹«æ‰‹</h1> <div style="font-size:12px;color:#fffdf8;opacity:0.9;margin-top:4px">åœ¨çµ‚é»é‡è¦‹æ›´å¥½çš„è‡ªå·±</div> </div> </header>
  <!-- å·¦ï¼šè¼¸å…¥å€ -->
<section class="card" aria-labelledby="inputs-title">
  <h2 id="inputs-title" style="margin:0 0 10px 0;">è¼¸å…¥åƒæ•¸</h2>
  <div class="inputs">
    <div>
      <label>åƒè³½çµ„åˆ¥</label>
      <select id="raceType" aria-label="åƒè³½çµ„åˆ¥">
        <option value="5">5KMï¼ˆå¥åº·ä¼‘é–’çµ„ï¼‰</option>
        <option value="10">10KMï¼ˆè·¯è·‘çµ„ï¼‰</option>
        <option value="21.095" selected>21.095KMï¼ˆåŠç¨‹é¦¬æ‹‰æ¾ï¼‰</option>
      </select>
    </div>

    <div class="row">
      <div class="col">
        <label>é è¨ˆå®Œè³½æ™‚é–“ - å°æ™‚</label>
        <input type="number" id="hours" min="0" value="1" />
      </div>
      <div class="col">
        <label>é è¨ˆå®Œè³½æ™‚é–“ - åˆ†é˜</label>
        <input type="number" id="minutes" min="0" max="59" value="30" />
      </div>
    </div>

    <div>
      <label>è£œçµ¦ç«™ä¼‘æ¯æ™‚é–“ï¼ˆæ¯ç«™ç§’ / å¯è¼¸å…¥ 0ï¼‰</label>
      <div id="stationsContainer" class="stations" aria-live="polite">
        <!-- è£œçµ¦ç«™æ¸…å–®ç”± JS æ ¹æ“šçµ„åˆ¥å‹•æ…‹ç”¢ç”Ÿ -->
      </div>
    </div>

    <div class="btns">
      <button class="calculate" id="calcBtn">é–‹å§‹è¨ˆç®—</button>
      <button class="reset" id="clearBtn" type="button">æ¸…é™¤æ‰€æœ‰è¼¸å…¥</button>
    </div>

    <div style="font-size:12px;color:var(--muted); margin-top:6px;">
      è£œçµ¦ç«™ä¼‘æ¯æ™‚é–“è«‹ä»¥ã€Œç§’ã€ç‚ºå–®ä½è¼¸å…¥ï¼ˆä¾‹ï¼š10 = 10 ç§’ï¼‰ã€‚è¡¨æ ¼æœƒè‡ªå‹•æ¨™ç¤ºè£œçµ¦ç«™æ‰€åœ¨å…¬é‡Œèˆ‡ä¼‘æ¯ç§’æ•¸ã€‚
    </div>
  </div>
</section>

<!-- å³ï¼šçµæœå€ -->
<aside class="result-panel">
  <div class="card summary" id="resultSummary">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <div>
        <div style="font-size:13px;color:var(--muted)">å¹³å‡é…é€Ÿ</div>
        <div class="pace-big" id="avgPace">--:-- / km</div>
        <div style="font-size:12px;color:var(--muted);margin-top:6px">ç¸½è·‘æ­¥æ™‚é–“ï¼ˆä¸å«è£œçµ¦ä¼‘æ¯ï¼‰ï¼š<span id="runTime">--:--:--</span></div>
      </div>
      <div style="text-align:right">
        <div style="font-size:12px;color:var(--muted)">ç¸½å…¬é‡Œæ•¸</div>
        <div style="font-weight:800;font-size:20px;color:var(--main-orange)" id="totalKm">21.095</div>
      </div>
    </div>
    <div class="encourage" id="encourageText">çµ¦ä½ ä¸€å¥é¼“å‹µè©±ï¼</div>
  </div>

  <div class="card" style="padding:8px;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div style="font-weight:800">é…é€Ÿè¡¨</div>
      <div style="font-size:12px;color:var(--muted)">æ¯å…¬é‡Œæ®µè½ï¼ˆå°¾æ®µè‹¥ç‚ºå°æ•¸å‰‡ä»¥å°æ•¸å…¬é‡Œé¡¯ç¤ºï¼‰</div>
    </div>
    <div class="table-wrap" id="tableWrap">
      <table id="paceTable" aria-live="polite">
        <thead>
          <tr>
            <th style="width:100px">æ®µæ¬¡ï¼ˆkmï¼‰</th>
            <th style="width:140px">è©²æ®µæ™‚é–“ï¼ˆmm:ssï¼‰</th>
            <th style="width:170px">ç´¯è¨ˆæ™‚é–“ï¼ˆhh:mm:ssï¼‰</th>
            <th>å‚™è¨»</th>
          </tr>
        </thead>
        <tbody>
          <!-- ç”± JS ç”¢ç”Ÿ -->
        </tbody>
      </table>
    </div>
  </div>

  <div class="weather card" id="weatherCard">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div style="font-weight:800">å°å— â€” æœªä¾† 36 å°æ™‚å¤©æ°£</div>
      <div style="font-size:12px;color:var(--muted)">è³‡æ–™ä¾†æºï¼šæä¾›çš„å¤©æ°£ API</div>
    </div>
    <div id="weatherArea">
      <div class="weather-list" id="weatherList">
        <!-- ç”± JS å¡«å…¥å¤©æ°£é …ç›® -->
      </div>
      <div id="weatherMsg" style="font-size:13px;color:var(--muted);margin-top:8px"></div>
    </div>
  </div>
</aside>

<footer>æœ¬å·¥å…·åƒ…ä¾›é…é€Ÿåƒè€ƒï¼Œå¯¦éš›æ¯”è³½è«‹ä¾ç¾å ´æŒ‡ç¤ºä¸¦é‡åŠ›è€Œç‚ºã€‚</footer>
  </div>
  <script>
    /******************************************************
     * å°å—å¤éƒ½åŠç¨‹é¦¬æ‹‰æ¾é…é€Ÿè¨ˆç®—å™¨ - åŸç”Ÿ JSï¼ˆå«è¨»è§£ï¼‰
     * - æœƒæ ¹æ“šä½¿ç”¨è€…é¸æ“‡çš„çµ„åˆ¥ç”¢ç”Ÿè£œçµ¦ç«™è¼¸å…¥æ¬„ä½ï¼ˆæ¯ç«™ç§’æ•¸ï¼‰
     * - è¨ˆç®—ç¸½è·‘æ­¥æ™‚é–“ã€å¹³å‡é…é€Ÿã€æ¯å…¬é‡Œé…é€Ÿè¡¨
     * - å‘ä½¿ç”¨è€…æä¾›çš„å¤©æ°£ API å–å¾—æœªä¾† 36 å°æ™‚å¤©æ°£ï¼ˆè‹¥å¯ç”¨ï¼‰
     ******************************************************/

    // --- è£œçµ¦ç«™è³‡æ–™ï¼ˆä¾†è‡ªä½¿ç”¨è€…æä¾›çš„æ¸…å–®ï¼‰ ---
    const STATIONS = {
      "21.095": [
        { d: 2.8, items: "é£²æ°´ã€å»æ‰€ã€é†«è­·ç«™", note: "æ¥ä¸‹ä¾†æ˜¯å¾®ä¸‹å¡ï¼Œåˆ¥å¤±æ§äº†å”·ğŸ˜…" },
        { d: 5.9, items: "é£²æ°´ã€é‹å‹•é£²æ–™ã€è£œçµ¦ç«™ã€å»æ‰€ã€é†«è­·ç«™", note: "æº–å‚™è¦é€²å…¥å®‰å¹³æ¸¯å€å›‰ğŸ¤“" },
        { d: 7.5, items: "é£²æ°´ã€æµ·ç¶¿ç«™ã€ç‰¹è‰²ç¾é£Ÿã€å»æ‰€", note: "æ¸¯å€å…§å°å°çš„æ©‹ï¼Œä¸è¦æ€•ğŸ«£" },
        { d: 10.0, items: "é£²æ°´ã€é‹å‹•é£²æ–™ã€è£œçµ¦ç«™ã€å»æ‰€ã€é†«è­·ç«™", note: "å·²ç¶“å®Œæˆä¸€åŠå›‰ğŸ¤—" },
        { d: 12.5, items: "é£²æ°´ã€æµ·ç¶¿ç«™ã€ç‰¹è‰²ç¾é£Ÿã€å»æ‰€", note: "å¥½å¥½æ¬£è³æ¸¯å€å…§çš„é¢¨æ™¯ğŸš¢" },
        { d: 15.0, items: "é£²æ°´ã€é‹å‹•é£²æ–™ã€è£œçµ¦ç«™ã€å»æ‰€ã€é†«è­·ç«™", note: "æº–å‚™è¿æ¥ç¬¬ä¸€è¶Ÿå¤§é­”ç‹çš„æ¼å…‰æ©‹ğŸ’ª" },
        { d: 17.5, items: "é£²æ°´ã€æµ·ç¶¿ç«™ã€ç‰¹è‰²ç¾é£Ÿã€å»æ‰€ã€é†«è­·ç«™", note: "çˆ¬å®Œæ©‹çš„ç¾é£Ÿè£œçµ¦ï¼Œè£œå¥½è£œæ»¿ğŸ˜‹" },
        { d: 20.0, items: "é£²æ°´ã€é‹å‹•é£²æ–™ã€è£œçµ¦ç«™ã€å»æ‰€ã€é†«è­·ç«™", note: "è½‰å€‹å½å°±åˆ°äº†ï¼Œçµ‚é»å°±åœ¨çœ¼å‰ğŸ†" }
      ],
      "10": [
        { d: 2.8, items: "é£²æ°´ã€å»æ‰€ã€é†«è­·ç«™", note: "æ¥ä¸‹ä¾†æ˜¯å¾®ä¸‹å¡ï¼Œåˆ¥å¤±æ§äº†å”·ğŸ˜…" },
        { d: 5.8, items: "é£²æ°´ã€é‹å‹•é£²æ–™ã€è£œçµ¦ç«™ã€å»æ‰€ã€é†«è­·ç«™", note: "å·²ç¶“å®Œæˆä¸€åŠå›‰ğŸ¤—" },
        { d: 7.5, items: "é£²æ°´ã€æµ·ç¶¿ç«™ã€ç‰¹è‰²ç¾é£Ÿã€å»æ‰€", note: "è½‰å€‹å½å°±åˆ°äº†ï¼Œçµ‚é»å°±åœ¨çœ¼å‰ğŸ†" }
      ],
      "5": [
        { d: 2.6, items: "é£²æ°´ã€é‹å‹•é£²æ–™ã€è£œçµ¦ç«™ã€ç‰¹è‰²ç¾é£Ÿã€å»æ‰€ã€é†«è­·ç«™", note: "å¥½å¥½äº«å—â˜ºï¸" }
      ]
    };

    // äº”é …éš¨æ©Ÿé¼“å‹µèª
    const ENCOURAGES = [
      "ä½ ä¸€å®šå¯ä»¥å®Œè³½ï¼ğŸ’ª",
      "ç©©ç©©é…é€Ÿï¼Œäº«å—è·¯ç¨‹ï¼ğŸƒâ€â™€ï¸ğŸƒâ€â™‚ï¸",
      "è£œçµ¦å–è¶³åŠ›æ°£ï¼Œçµ‚é»ç­‰ä½ ä¾†ï¼ğŸ¥¤",
      "ä¸€æ­¥ä¸€æ­¥ä¾†ï¼Œå¥‡è¹Ÿåœ¨å‰æ–¹ï¼âœ¨",
      "ä½ æ¯”ä½ æƒ³åƒçš„æ›´å¼·ï¼åŠ æ²¹ï¼ğŸ”¥"
    ];

    // DOM references
    const raceTypeEl = document.getElementById('raceType');
    const stationsContainer = document.getElementById('stationsContainer');
    const hoursEl = document.getElementById('hours');
    const minutesEl = document.getElementById('minutes');
    const calcBtn = document.getElementById('calcBtn');
    const clearBtn = document.getElementById('clearBtn');

    const avgPaceEl = document.getElementById('avgPace');
    const runTimeEl = document.getElementById('runTime');
    const totalKmEl = document.getElementById('totalKm');
    const encourageEl = document.getElementById('encourageText');
    const paceTableBody = document.querySelector('#paceTable tbody');

    // Weather
    const weatherListEl = document.getElementById('weatherList');
    const weatherMsg = document.getElementById('weatherMsg');
    const WEATHER_API = "https://weather-joyce.zeabur.app/api/weather/kaohsiung"; // ä½¿ç”¨è€…æä¾›çš„ API

    // åˆå§‹åŒ–ï¼šå»ºç«‹è£œçµ¦ç«™æ¬„ä½ï¼ˆä¾çµ„åˆ¥ï¼‰
    function renderStations(){
      const val = raceTypeEl.value;
      const stations = STATIONS[val] || [];
      stationsContainer.innerHTML = '';
      stations.forEach((s, idx) => {
        const div = document.createElement('div');
        div.className = 'station';
        div.innerHTML = `
          <div style="flex:1;">
            <div class="meta">ç¬¬ ${s.d} km â€” ${s.items}</div>
            <small>${s.note}</small>
          </div>
          <div style="min-width:150px; text-align:right;">
            <label style="display:block;font-size:12px;color:var(--muted);margin-bottom:4px">ä¼‘æ¯ç§’æ•¸ (ç§’)</label>
            <input type="number" min="0" value="0" data-distance="${s.d}" class="restInput" style="width:110px;padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)"/>
          </div>
        `;
        stationsContainer.appendChild(div);
      });
    }

    // å·¥å…·å‡½å¼ï¼šæ ¼å¼åŒ– mm:ssï¼ˆåˆ†é˜:ç§’ï¼‰
    function formatMMSS(totalSeconds){
      if (!isFinite(totalSeconds) || totalSeconds < 0) totalSeconds = 0;
      const m = Math.floor(totalSeconds / 60);
      const s = Math.round(totalSeconds % 60);
      return String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0');
    }
    // å·¥å…·å‡½å¼ï¼šæ ¼å¼åŒ– hh:mm:ss
    function formatHHMMSS(totalSeconds){
      if (!isFinite(totalSeconds) || totalSeconds < 0) totalSeconds = 0;
      const h = Math.floor(totalSeconds / 3600);
      const m = Math.floor((totalSeconds % 3600) / 60);
      const s = Math.round(totalSeconds % 60);
      return String(h).padStart(2,'0') + ':' + String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0');
    }

    // ä¸»è¨ˆç®—é‚è¼¯
    function calculate(){
      // å–å¾—åŸºæœ¬è¼¸å…¥
      const raceKm = parseFloat(raceTypeEl.value);
      totalKmEl.textContent = raceKm;
      const h = Number(hoursEl.value) || 0;
      const m = Number(minutesEl.value) || 0;
      const totalFinishSeconds = h * 3600 + m * 60;

      // å–å¾—æ‰€æœ‰è£œçµ¦ç«™ä¼‘æ¯ç¸½å’Œ
      const restInputs = document.querySelectorAll('.restInput');
      let totalRest = 0;
      const restByDistance = {}; // e.g., {2.8: 10}
      restInputs.forEach(input => {
        const seconds = Math.max(0, Number(input.value) || 0);
        const dist = Number(input.dataset.distance);
        totalRest += seconds;
        restByDistance[dist] = seconds;
      });

      // ç¸½è·‘æ­¥æ™‚é–“ï¼ˆç§’ï¼‰
      const totalRunSeconds = totalFinishSeconds - totalRest;

      // è‹¥ç¸½è·‘æ­¥æ™‚é–“ <= 0 -> é¡¯ç¤ºéŒ¯èª¤ï¼ˆä»¥ alert æˆ–è¨Šæ¯ï¼‰
      if (totalRunSeconds <= 0){
        avgPaceEl.textContent = "--:-- / km";
        runTimeEl.textContent = "--:--:--";
        paceTableBody.innerHTML = '';
        alert("éŒ¯èª¤ï¼šè£œçµ¦ç«™ä¼‘æ¯æ™‚é–“éé•·æˆ–é ä¼°å®Œè³½æ™‚é–“éçŸ­ï¼Œè«‹é‡æ–°è¼¸å…¥ã€‚");
        return;
      }

      // å¹³å‡é…é€Ÿï¼ˆç§’ / kmï¼‰
      const paceSecPerKm = totalRunSeconds / raceKm;
      avgPaceEl.textContent = formatMMSS(paceSecPerKm) + " / km";
      runTimeEl.textContent = formatHHMMSS(totalRunSeconds);

      // éš¨æ©Ÿé¼“å‹µèª
      encourageEl.textContent = ENCOURAGES[Math.floor(Math.random() * ENCOURAGES.length)];

      // ç”¢ç”Ÿæ¯å…¬é‡Œé…é€Ÿè¡¨
      // è¦å‰‡ï¼šæ¯ 1 km ä¸€åˆ—ï¼Œè‹¥å°¾æ®µç‚ºå°æ•¸å‰‡æœ€å¾Œä¸€è¡Œä»¥å°æ•¸å…¬é‡Œè¡¨ç¤º
      paceTableBody.innerHTML = '';
      // segment boundaries: from 0 to raceKm, we create segments of length 1 until remainder
      const segments = [];
      let covered = 0;
      while (covered + 1 <= Math.floor(raceKm)){
        segments.push(1.0);
        covered += 1.0;
      }
      const remainder = +(raceKm - covered).toFixed(6);
      if (remainder > 0.000001){
        segments.push(remainder);
      }

      // For each segment, the segment time = paceSecPerKm * segmentLength
      let cumulative = 0;
      segments.forEach((segLen, idx) => {
        const segSeconds = paceSecPerKm * segLen;
        cumulative += segSeconds;
        // segment label: e.g., "1", "2", ..., last: "21.095 - 21.095"
        // We'll display segment start-end range for clarity: e.g., "1 (0-1km)" but requirement: æ®µæ¬¡ï¼ˆkmï¼‰ => we show "1", "2", ..., last as decimal
        const segLabel = (() => {
          const startKm = segments.slice(0, idx).reduce((a,b)=>a+b,0);
          const endKm = +(startKm + segLen).toFixed(3);
          // display as (start+1) for full 1km segments, last as endKm
          if (segLen === 1) return String(Math.floor(startKm)+1);
          return `${(startKm+1).toFixed(3)}-${endKm}`; // e.g., "21.000-21.095"
        })();

        // check if any station falls inside this segment
        // segment covers (startKm, endKm] in km measure
        const startKmVal = segments.slice(0, idx).reduce((a,b)=>a+b,0);
        const endKmVal = startKmVal + segLen;
        // find stations whose distance > startKmVal and <= endKmVal (inclusive at end)
        const stationsInSeg = Object.keys(restByDistance).map(Number).filter(d => d > startKmVal - 1e-9 && d <= endKmVal + 1e-9);

        let remark = '';
        if (stationsInSeg.length){
          remark = stationsInSeg.map(d => `è£œçµ¦ç«™ï¼ˆ${d} kmï¼‰ â€” ä¼‘ ${restByDistance[d] || 0} ç§’`).join('ï¼› ');
        }

        // create row
        const tr = document.createElement('tr');
        const tdSeg = document.createElement('td');
        tdSeg.textContent = segLabel;
        const tdSegTime = document.createElement('td');
        tdSegTime.textContent = formatMMSS(segSeconds);
        const tdCum = document.createElement('td');
        tdCum.textContent = formatHHMMSS(cumulative);
        const tdRemark = document.createElement('td');
        tdRemark.className = 'remark';
        tdRemark.textContent = remark;
        tr.appendChild(tdSeg);
        tr.appendChild(tdSegTime);
        tr.appendChild(tdCum);
        tr.appendChild(tdRemark);
        paceTableBody.appendChild(tr);
      });

      // scroll table to top
      document.getElementById('tableWrap').scrollLeft = 0;
    }

    // æ¸…é™¤æ‰€æœ‰è¼¸å…¥
    function clearAll(){
      hoursEl.value = '';
      minutesEl.value = '';
      // reset rest inputs to 0
      document.querySelectorAll('.restInput').forEach(inp => inp.value = 0);
      avgPaceEl.textContent = "--:-- / km";
      runTimeEl.textContent = "--:--:--";
      paceTableBody.innerHTML = '';
      encourageEl.textContent = 'ä½ ä¸€å®šå¯ä»¥å®Œè³½ï¼';
    }

    // å–å¾—å¤©æ°£ï¼ˆå˜—è©¦è§£æå¸¸è¦‹ JSON çµæ§‹ï¼‰
    async function fetchWeather(){
      weatherListEl.innerHTML = '';
      weatherMsg.textContent = "è¼‰å…¥ä¸­â€¦â€¦";
      try {
        const res = await fetch(WEATHER_API, {cache:'no-store'});
        if (!res.ok) throw new Error("ç¶²è·¯éŒ¯èª¤ï¼š" + res.status);
        const data = await res.json();

        // å˜—è©¦ä¾ä¸åŒ API æ ¼å¼è§£æï¼ˆç›¡é‡å½ˆæ€§è™•ç†ï¼‰
        // å¯èƒ½çš„çµæ§‹ï¼š { hourly: [ { dt: ..., temp:..., weather:[{description, icon}] }, ... ] }
        // æˆ–ï¼š { hours: [...] } æˆ–ç›´æ¥é™£åˆ—
        let hours = [];
        if (Array.isArray(data)){
          hours = data;
        } else if (Array.isArray(data.hourly)){
          hours = data.hourly;
        } else if (Array.isArray(data.hours)){
          hours = data.hours;
        } else if (data.data && Array.isArray(data.data)){
          hours = data.data;
        } else {
          // æœç´¢ä»»ä½•å±¬æ€§ç‚ºé™£åˆ—
          for (const k in data){
            if (Array.isArray(data[k]) && data[k].length && data[k][0].temp !== undefined){
              hours = data[k]; break;
            }
          }
        }

        if (!hours || hours.length === 0){
          weatherMsg.textContent = "å¤©æ°£è³‡æ–™æ ¼å¼ä¸æ”¯æ´æˆ–ç„¡è³‡æ–™ã€‚";
          return;
        }

        // æ‹¿åˆ°æœªä¾† 36 å°æ™‚ï¼ˆå¦‚æœæ¯ç­†ç‚ºå°æ™‚è³‡æ–™ï¼‰
        const first36 = hours.slice(0,36);
        weatherListEl.innerHTML = '';
        first36.forEach(h => {
          // å¯èƒ½æ¬„ä½ï¼š dt (unix ç§’)ã€timeã€tempã€temperatureã€weather[0].descriptionã€icon
          const timeLabel = (() => {
            if (h.dt) return (new Date(h.dt*1000)).getHours() + ":00";
            if (h.time) return String(h.time).slice(11,16);
            if (h.datetime) return String(h.datetime).slice(11,16);
            if (h.date) return String(h.date).slice(11,16);
            return "";
          })();
          const temp = h.temp ?? h.temperature ?? h.t ?? (h.main && h.main.temp) ?? '--';
          const desc = (h.weather && h.weather[0] && h.weather[0].description) || h.description || h.text || '';
          const icon = (h.weather && h.weather[0] && h.weather[0].icon) || '';

          // cute orange/yellow style icon: we'll map basic keywords to emoji-like icons (å¯æ„›é¢¨)
          const iconEl = (() => {
            const d = (desc || '').toLowerCase();
            if (d.includes('rain') || d.includes('é›¨')) return 'ğŸŒ§ï¸';
            if (d.includes('cloud') || d.includes('å¤šé›²') || d.includes('é™°')) return 'â›…';
            if (d.includes('clear') || d.includes('æ™´')) return 'â˜€ï¸';
            if (d.includes('thunder') || d.includes('é›·')) return 'â›ˆï¸';
            if (d.includes('snow') || d.includes('é›ª')) return 'â„ï¸';
            return 'ğŸŒ¤ï¸';
          })();

          const item = document.createElement('div');
          item.className = 'weather-item';
          item.innerHTML = `
            <div class="weather-time">${timeLabel}</div>
            <div style="font-size:28px;margin-top:6px">${iconEl}</div>
            <div class="weather-temp">${Math.round(temp)}Â°C</div>
            <div class="weather-desc">${desc}</div>
          `;
          weatherListEl.appendChild(item);
        });

        weatherMsg.textContent = '';
      } catch (e){
        weatherMsg.textContent = "ç„¡æ³•å–å¾—å¤©æ°£è³‡æ–™ï¼ˆAPI å¯èƒ½ä¸å¯ç”¨ï¼‰ã€‚";
        console.error('weather error:', e);
      }
    }

    // äº‹ä»¶ç¶å®š
    raceTypeEl.addEventListener('change', () => {
      renderStations();
      // reset results when switching race
      avgPaceEl.textContent = "--:-- / km";
      runTimeEl.textContent = "--:--:--";
      paceTableBody.innerHTML = '';
      totalKmEl.textContent = raceTypeEl.value;
    });
    calcBtn.addEventListener('click', calculate);
    clearBtn.addEventListener('click', clearAll);

    // åˆå§‹åŒ–é é¢
    (function init(){
      renderStations();
      // show initial encourage
      encourageEl.textContent = ENCOURAGES[0];
      totalKmEl.textContent = raceTypeEl.value;

      // å˜—è©¦å–å¾—å¤©æ°£ï¼ˆèƒŒæ™¯åŸ·è¡Œï¼‰
      fetchWeather().catch(()=>{});
    })();

    // Accessibility: allow Enter to trigger calculate when focus in inputs
    document.querySelectorAll('input').forEach(inp => {
      inp.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          calculate();
        }
      });
    });

  </script>
</body>
</html>